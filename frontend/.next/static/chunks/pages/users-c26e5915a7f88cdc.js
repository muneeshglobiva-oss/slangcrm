(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{7476:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return t(9585)}])},9585:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return o}});var s=t(5893),d=t(7294);function o(e){let{user:r}=e,[t,o]=(0,d.useState)([]),[a,l]=(0,d.useState)(!0),[n,i]=(0,d.useState)(""),[c,u]=(0,d.useState)(!1),[m,x]=(0,d.useState)(null),[h,p]=(0,d.useState)({name:"",email:"",role:"user",password:""});(0,d.useEffect)(()=>{r&&"admin"===r.role&&b()},[r]);let b=async()=>{try{let e=localStorage.getItem("token"),r=await fetch("/api/users",{headers:{Authorization:"Bearer ".concat(e)}});if(!r.ok)throw Error("Failed to fetch users");let t=await r.json();o(t)}catch(e){i(e.message)}finally{l(!1)}},g=async e=>{e.preventDefault();try{let e=localStorage.getItem("token"),r=m?"/api/users/".concat(m.id):"/api/users";if(!(await fetch(r,{method:m?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(h)})).ok)throw Error("Failed to save user");u(!1),x(null),p({name:"",email:"",role:"user",password:""}),b()}catch(e){i(e.message)}},f=e=>{x(e),p({name:e.name,email:e.email,role:e.role,password:""}),u(!0)},y=async e=>{if(confirm("Are you sure you want to delete this user?"))try{let r=localStorage.getItem("token");if(!(await fetch("/api/users/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}})).ok)throw Error("Failed to delete user");b()}catch(e){i(e.message)}};return r&&"admin"!==r.role?(0,s.jsx)("div",{className:"p-8 text-center text-red-600",children:"Access denied. Admin privileges required."}):a?(0,s.jsx)("div",{className:"p-8 text-center",children:"Loading..."}):n?(0,s.jsxs)("div",{className:"p-8 text-center text-red-600",children:["Error: ",n]}):(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Manage Users"}),(0,s.jsx)("button",{onClick:()=>{x(null),p({name:"",email:"",role:"user",password:""}),u(!0)},className:"mb-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add New User"}),c&&(0,s.jsxs)("form",{onSubmit:g,className:"mb-8 p-4 border border-gray-300 rounded",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:m?"Edit User":"Add New User"}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Name:"}),(0,s.jsx)("input",{type:"text",value:h.name,onChange:e=>p({...h,name:e.target.value}),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email:"}),(0,s.jsx)("input",{type:"email",value:h.email,onChange:e=>p({...h,email:e.target.value}),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Role:"}),(0,s.jsxs)("select",{value:h.role,onChange:e=>p({...h,role:e.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[(0,s.jsx)("option",{value:"user",children:"User"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:["Password ",m?"(leave blank to keep current)":"",":"]}),(0,s.jsx)("input",{type:"password",value:h.password,onChange:e=>p({...h,password:e.target.value}),required:!m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,s.jsx)("button",{type:"submit",className:"mr-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:m?"Update":"Create"}),(0,s.jsx)("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]}),(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{background:"#f8f9fa"},children:[(0,s.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",border:"1px solid #dee2e6"},children:"Name"}),(0,s.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",border:"1px solid #dee2e6"},children:"Email"}),(0,s.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",border:"1px solid #dee2e6"},children:"Role"}),(0,s.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",border:"1px solid #dee2e6"},children:"Created At"}),(0,s.jsx)("th",{style:{padding:"0.75rem",textAlign:"left",border:"1px solid #dee2e6"},children:"Actions"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #dee2e6"},children:e.name}),(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #dee2e6"},children:e.email}),(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #dee2e6"},children:e.role}),(0,s.jsx)("td",{style:{padding:"0.75rem",border:"1px solid #dee2e6"},children:new Date(e.created_at).toLocaleDateString()}),(0,s.jsxs)("td",{style:{padding:"0.75rem",border:"1px solid #dee2e6"},children:[(0,s.jsx)("button",{onClick:()=>f(e),style:{padding:"0.25rem 0.5rem",background:"#ffc107",color:"#000",border:"none",borderRadius:"4px",cursor:"pointer",marginRight:"0.25rem"},children:"Edit"}),(0,s.jsx)("button",{onClick:()=>y(e.id),style:{padding:"0.25rem 0.5rem",background:"#dc3545",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Delete"})]})]},e.id))})]})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=7476)}),_N_E=e.O()}]);